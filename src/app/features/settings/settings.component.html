
    <div class="h-full flex flex-col animate-fade-in">
      <header class="flex justify-between items-center mb-6">
        <div>
          <h2 class="text-2xl font-light tracking-tight text-slate-800">Settings</h2>
          <p class="text-sm text-slate-500 font-light mt-1">Manage organization, security and preferences</p>
        </div>
      </header>

      <div class="glass-panel rounded-xl flex flex-col flex-1 overflow-hidden md:flex-row">
        
        <!-- Settings Sidebar / Tabs -->
        <div class="w-full md:w-64 bg-slate-50/50 border-b md:border-b-0 md:border-r border-slate-100 p-4 flex md:flex-col gap-2 overflow-x-auto">
           <button (click)="activeTab.set('general')" 
             [class]="activeTab() === 'general' ? 'bg-white text-teal-700 shadow-sm border-slate-200' : 'text-slate-500 hover:bg-white/50 border-transparent'"
             class="flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium border transition-all whitespace-nowrap">
             <app-icon name="sliders" [size]="18"></app-icon> General
           </button>
           
           <button (click)="activeTab.set('branches')" 
             [class]="activeTab() === 'branches' ? 'bg-white text-teal-700 shadow-sm border-slate-200' : 'text-slate-500 hover:bg-white/50 border-transparent'"
             class="flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium border transition-all whitespace-nowrap">
             <app-icon name="map-pin" [size]="18"></app-icon> Branches
           </button>

           <button (click)="activeTab.set('team')" 
             [class]="activeTab() === 'team' ? 'bg-white text-teal-700 shadow-sm border-slate-200' : 'text-slate-500 hover:bg-white/50 border-transparent'"
             class="flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium border transition-all whitespace-nowrap">
             <app-icon name="users" [size]="18"></app-icon> Team
           </button>
           
           <button (click)="activeTab.set('security')" 
             [class]="activeTab() === 'security' ? 'bg-white text-teal-700 shadow-sm border-slate-200' : 'text-slate-500 hover:bg-white/50 border-transparent'"
             class="flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium border transition-all whitespace-nowrap">
             <app-icon name="shield" [size]="18"></app-icon> Security
           </button>

           <button (click)="activeTab.set('data')" 
             [class]="activeTab() === 'data' ? 'bg-white text-teal-700 shadow-sm border-slate-200' : 'text-slate-500 hover:bg-white/50 border-transparent'"
             class="flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium border transition-all whitespace-nowrap">
             <app-icon name="database" [size]="18"></app-icon> Data Management
           </button>
        </div>

        <!-- Content Area -->
        <div class="flex-1 p-6 overflow-y-auto bg-white/40">
           
           <!-- General Tab -->
           @if (activeTab() === 'general') {
             <div class="max-w-2xl animate-fade-in space-y-8">
               <section>
                 <h3 class="text-lg font-medium text-slate-800 mb-4 pb-2 border-b border-slate-100">Organization Profile</h3>
                 <div class="space-y-4">
                    <div>
                      <label class="block text-sm font-medium text-slate-700 mb-1">Organization Name</label>
                      <input type="text" [ngModel]="store.tenant()?.name" (ngModelChange)="updateOrg('name', $event)" class="glass-input w-full px-4 py-2 rounded-lg text-sm bg-white">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                       <div>
                         <label class="block text-sm font-medium text-slate-700 mb-1">Country</label>
                         <select [ngModel]="store.tenant()?.country" (ngModelChange)="updateOrg('country', $event)" class="glass-input w-full px-4 py-2 rounded-lg text-sm bg-white">
                           <option value="Yemen">Yemen</option>
                           <option value="Saudi Arabia">Saudi Arabia</option>
                           <option value="Egypt">Egypt</option>
                         </select>
                       </div>
                       <div>
                         <label class="block text-sm font-medium text-slate-700 mb-1">Default Currency</label>
                         <select [ngModel]="store.tenant()?.currency" (ngModelChange)="updateOrg('currency', $event)" class="glass-input w-full px-4 py-2 rounded-lg text-sm bg-white">
                           <option value="YER">YER (Yemeni Rial)</option>
                           <option value="SAR">SAR (Saudi Riyal)</option>
                           <option value="USD">USD (US Dollar)</option>
                         </select>
                       </div>
                    </div>
                 </div>
               </section>

               <section>
                 <h3 class="text-lg font-medium text-slate-800 mb-4 pb-2 border-b border-slate-100">Localization</h3>
                 <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">System Language</label>
                    <div class="flex gap-4">
                      <button class="px-4 py-2 rounded-lg border border-teal-500 bg-teal-50 text-teal-700 font-medium">English</button>
                      <button class="px-4 py-2 rounded-lg border border-slate-200 bg-white text-slate-600 hover:bg-slate-50">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Coming Soon)</button>
                    </div>
                 </div>
               </section>
             </div>
           }

           <!-- Branches Tab -->
           @if (activeTab() === 'branches') {
             <div class="animate-fade-in h-full flex flex-col">
               <div class="flex justify-between items-center mb-6">
                 <div>
                   <h3 class="text-lg font-medium text-slate-800">Branch Management</h3>
                   <p class="text-sm text-slate-500">Manage locations and licenses</p>
                 </div>
                 <button class="px-4 py-2 bg-slate-800 text-white rounded-lg text-sm font-medium shadow-lg hover:bg-slate-700">Add New Branch</button>
               </div>
               
               <div class="space-y-3">
                 @for (branch of store.branches(); track branch.id) {
                   <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm flex items-center justify-between group hover:border-teal-200 transition-all">
                      <div class="flex items-center gap-4">
                         <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-400 group-hover:bg-teal-50 group-hover:text-teal-600 transition-colors">
                           <app-icon name="map-pin" [size]="20"></app-icon>
                         </div>
                         <div>
                           <div class="font-medium text-slate-800">{{ branch.name }}</div>
                           <div class="text-xs text-slate-500">{{ branch.location }} â€¢ {{ branch.code }}</div>
                         </div>
                      </div>
                      <div class="flex items-center gap-6">
                         <div class="text-right">
                           <div class="text-xs text-slate-400">Status</div>
                           <div class="text-sm font-medium text-emerald-600 flex items-center gap-1">
                             <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span> Active
                           </div>
                         </div>
                         <button class="p-2 text-slate-300 hover:text-slate-600">
                           <app-icon name="more-horizontal" [size]="20"></app-icon>
                         </button>
                      </div>
                   </div>
                 }
               </div>
             </div>
           }

           <!-- Team Tab (New) -->
           @if (activeTab() === 'team') {
             <div class="animate-fade-in h-full flex flex-col">
               <div class="flex justify-between items-center mb-6">
                 <div>
                   <h3 class="text-lg font-medium text-slate-800">Team & Employees</h3>
                   <p class="text-sm text-slate-500">Manage user access and branch assignments</p>
                 </div>
               </div>

               <!-- Add Employee Form (Inline for settings) -->
               <div class="bg-white p-6 rounded-xl border border-slate-100 shadow-sm mb-8">
                  <h4 class="text-sm font-semibold text-slate-700 mb-4 uppercase tracking-wider flex items-center gap-2">
                    <app-icon name="user-plus" [size]="16"></app-icon> Add New Employee
                  </h4>
                  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end">
                    <div>
                      <label class="block text-xs font-medium text-slate-500 mb-1">Full Name</label>
                      <input type="text" [(ngModel)]="newEmployee.name" placeholder="Ex. Omar Ali" class="glass-input w-full px-3 py-2 rounded-lg text-sm bg-slate-50">
                    </div>
                    <div>
                      <label class="block text-xs font-medium text-slate-500 mb-1">Email</label>
                      <input type="email" [(ngModel)]="newEmployee.email" placeholder="user@pharmacy.com" class="glass-input w-full px-3 py-2 rounded-lg text-sm bg-slate-50">
                    </div>
                    <div>
                       <label class="block text-xs font-medium text-slate-500 mb-1">Role</label>
                       <select [(ngModel)]="newEmployee.role" class="glass-input w-full px-3 py-2 rounded-lg text-sm bg-slate-50 appearance-none">
                         <option value="branch_admin">Branch Admin</option>
                         <option value="section_admin">Section Admin</option>
                         <option value="super_admin">Super Admin</option>
                       </select>
                    </div>
                    <div>
                       <label class="block text-xs font-medium text-slate-500 mb-1">Assign Branch</label>
                       <select [(ngModel)]="newEmployee.branchId" class="glass-input w-full px-3 py-2 rounded-lg text-sm bg-slate-50 appearance-none">
                         <option value="">-- Select Branch --</option>
                         @for (branch of store.branches(); track branch.id) {
                           <option [value]="branch.id">{{ branch.name }}</option>
                         }
                       </select>
                    </div>
                  </div>
                  <div class="mt-4 flex justify-end">
                    <button (click)="addEmployee()" [disabled]="!newEmployee.email || !newEmployee.name" class="px-6 py-2 bg-teal-500 text-white rounded-lg text-sm font-medium shadow hover:bg-teal-600 disabled:opacity-50 transition-all">
                      Add Employee
                    </button>
                  </div>
               </div>
               
               <!-- Employee List -->
               <h4 class="text-sm font-semibold text-slate-700 mb-3">All Employees</h4>
               <div class="space-y-3 flex-1 overflow-y-auto pr-1">
                 @for (user of store.users(); track user.id) {
                   <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm flex items-center justify-between group hover:border-teal-200 transition-all">
                      <div class="flex items-center gap-4">
                         <img [src]="user.avatar" class="w-10 h-10 rounded-full bg-slate-100 object-cover border border-white shadow-sm">
                         <div>
                           <div class="font-medium text-slate-800">{{ user.name }}</div>
                           <div class="text-xs text-slate-500">{{ user.email }}</div>
                         </div>
                      </div>
                      <div class="flex items-center gap-8">
                         <div>
                            <div class="text-xs text-slate-400">Role</div>
                            <span class="text-xs font-medium px-2 py-0.5 rounded-full" 
                              [class.bg-purple-50]="user.role === 'super_admin'" [class.text-purple-600]="user.role === 'super_admin'"
                              [class.bg-blue-50]="user.role === 'branch_admin'" [class.text-blue-600]="user.role === 'branch_admin'"
                              [class.bg-slate-50]="user.role === 'section_admin'" [class.text-slate-600]="user.role === 'section_admin'">
                              {{ user.role.replace('_', ' ') | titlecase }}
                            </span>
                         </div>
                         <div class="min-w-[120px]">
                            <div class="text-xs text-slate-400">Assigned Branch</div>
                            <div class="text-sm text-slate-700 font-medium truncate">
                              {{ getBranchName(user.branchId) }}
                            </div>
                         </div>
                         <button class="p-2 text-slate-300 hover:text-red-500 transition-colors">
                           <app-icon name="trash-2" [size]="18"></app-icon>
                         </button>
                      </div>
                   </div>
                 }
               </div>
             </div>
           }

           <!-- Security Tab -->
           @if (activeTab() === 'security') {
             <div class="max-w-2xl animate-fade-in space-y-6">
                <h3 class="text-lg font-medium text-slate-800 mb-4 pb-2 border-b border-slate-100">Access Control</h3>
                
                <div class="bg-white p-4 rounded-xl border border-slate-100 flex items-start justify-between">
                   <div>
                     <div class="font-medium text-slate-800">Two-Factor Authentication</div>
                     <p class="text-sm text-slate-500 mt-1">Require email code when logging in from new devices.</p>
                   </div>
                   <button class="w-12 h-6 rounded-full bg-slate-200 relative transition-colors"><div class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full shadow-sm"></div></button>
                </div>

                <div class="bg-white p-4 rounded-xl border border-slate-100 flex items-start justify-between">
                   <div>
                     <div class="font-medium text-slate-800">Session Timeout</div>
                     <p class="text-sm text-slate-500 mt-1">Automatically log out inactive users after 30 minutes.</p>
                   </div>
                   <button class="w-12 h-6 rounded-full bg-teal-500 relative transition-colors"><div class="absolute right-1 top-1 w-4 h-4 bg-white rounded-full shadow-sm"></div></button>
                </div>
                
                <div class="pt-6">
                  <h3 class="text-lg font-medium text-slate-800 mb-4 pb-2 border-b border-slate-100">Audit Logs</h3>
                  <button class="flex items-center gap-2 text-sm text-teal-600 font-medium hover:underline">
                    <app-icon name="file-text" [size]="16"></app-icon> View Activity Logs
                  </button>
                </div>
             </div>
           }

           <!-- Data Tab -->
           @if (activeTab() === 'data') {
             <div class="max-w-2xl animate-fade-in space-y-6">
                <h3 class="text-lg font-medium text-slate-800 mb-4 pb-2 border-b border-slate-100">Data & Backup</h3>
                
                <div class="bg-white p-5 rounded-xl border border-slate-100 shadow-sm">
                   <div class="flex items-center gap-3 mb-3">
                     <div class="p-2 bg-blue-50 text-blue-600 rounded-lg">
                       <app-icon name="download" [size]="20"></app-icon>
                     </div>
                     <h4 class="font-medium text-slate-800">Export All Data</h4>
                   </div>
                   <p class="text-sm text-slate-500 mb-4">Download a complete JSON archive of your inventory, sales, and user data.</p>
                   <button class="px-4 py-2 border border-slate-200 rounded-lg text-sm text-slate-600 hover:bg-slate-50 font-medium">Download Archive</button>
                </div>

                 <div class="bg-white p-5 rounded-xl border border-red-100 shadow-sm">
                   <div class="flex items-center gap-3 mb-3">
                     <div class="p-2 bg-red-50 text-red-600 rounded-lg">
                       <app-icon name="trash-2" [size]="20"></app-icon>
                     </div>
                     <h4 class="font-medium text-slate-800">Danger Zone</h4>
                   </div>
                   <p class="text-sm text-slate-500 mb-4">Permanently delete organization account and all associated data.</p>
                   <button class="px-4 py-2 bg-red-50 border border-red-200 rounded-lg text-sm text-red-600 hover:bg-red-100 font-medium">Delete Organization</button>
                </div>
             </div>
           }

        </div>
      </div>
    </div>
  
